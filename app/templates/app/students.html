{% extends "base.html" %}
{% block title %}Student details{% endblock title %}
{% load static %}
{% block content %}
<div class="col-lg-8 col-md-8 col-sm-12 main-content">                    
    <h2 class="text-center">ğ‘©ğ’“ğ’Šğ’ˆğ’‰ğ’•ğ’ğ’ ğ‘ºğ’„ğ’‰ğ’ğ’ğ’</h2>
    <h3 class="text-center">{{ class_instance.class_name }}</h3>
    <div id="notification" class="alert alert-success" role="alert" style="display: none;">
        Saved successfully!
    </div>
    <form id="studentForm" method="POST" novalidate>
        {% csrf_token %}
        <table class="table table-bordered">
            <thead style="background-color: rgb(240, 208, 170);">
                <tr>
                    <th>Student Name</th>
                    <th class="address-col">Address</th>
                    <th class="address-col">Contact No</th>
                    <th class="address-col">Parent's Name</th>
                    <th>Blood Group</th>
                    <th class="address-col">Emergency Contact</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody style="background-color: rgb(240, 208, 170);">
                {% for student in students %}
                <tr id="student-{{ student.id }}">
                    <td>{{ student.st_name }}</td>
                    <td>{{ student.address }}</td>
                    <td>{{ student.contact_no }}</td>
                    <td>{{ student.parents_names }}</td>
                    <td>{{ student.blood_gr }}</td>
                    <td>{{ student.emergency }}</td>
                    <td>
                        <button type="button" class="btn btn-primary edit-btn" data-id="{{ student.id }}">Edit</button>
                        <button type="button" class="btn btn-danger delete-btn" data-id="{{ student.id }}">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h3 class="text-center"> Edit the details</h3>
        <div class="rounded" style="background-color: rgb(240, 208, 170);">
        <form>
            <input type="hidden" name="student_id" id="student_id" value="">
            <div class="form-group row justify-content-center">
                <label for="id_st_name" class="col-sm-2 col-form-label text-center mt-2">Student Name</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control mt-2" name="st_name" id="id_st_name" value="">
                </div>
            </div>
            <div class="form-group row justify-content-center">
                <label for="id_address" class="col-sm-2 col-form-label text-center">Address</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" name="address" id="id_address" value="">
                </div>
            </div>
            <div class="form-group row justify-content-center">
                <label for="id_contact_no" class="col-sm-2 col-form-label text-center">Contact No</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" name="contact_no" id="id_contact_no" value="">
                </div>
            </div>
            <div class="form-group row justify-content-center">
                <label for="id_parents_names" class="col-sm-2 col-form-label text-center">Parent's Name</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control mt-1" name="parents_names" id="id_parents_names" value="">
                </div>
            </div>
            <div class="form-group row justify-content-center">
                <label for="id_blood_gr" class="col-sm-2 col-form-label text-center mt-2">Blood Group</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control mt-2" name="blood_gr" id="id_blood_gr" value="">
                </div>
            </div>
            <div class="form-group row justify-content-center">
                <label for="id_emergency" class="col-sm-2 col-form-label text-center">Emergency Contact</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control mt-2" name="emergency" id="id_emergency" value="">
                </div>
            </div>
        </form>
    </div>
          
        <button type="submit" class="btn btn-success">Submit</button>
    </form>                 
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    fetch(`/get_student/${studentId}/`)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('student_id').value = data.id;
                            document.getElementById('id_st_name').value = data.st_name;
                            document.getElementById('id_address').value = data.address;
                            document.getElementById('id_contact_no').value = data.contact_no;
                            document.getElementById('id_parents_names').value = data.parents_names;
                            document.getElementById('id_blood_gr').value = data.blood_gr;
                            document.getElementById('id_emergency').value = data.emergency;
                        })
                        .catch(error => console.error("Error fetching data:", error));
                });
            });
        
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    fetch(`/delete_student/${studentId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            const row = document.getElementById(`student-${studentId}`);
                            row.parentNode.removeChild(row);
                        }
                    });
                });
            });

            const params = new URLSearchParams(window.location.search);
            if (params.get('saved') === 'true') {
                const notification = document.getElementById('notification');
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 7000);
            }
        });
        
</script>
{% endblock content %}
