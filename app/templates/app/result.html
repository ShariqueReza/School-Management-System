{% extends "base.html" %}
{% block title %}Result details{% endblock title %}
{% load static %}
{% block content %}               
                <div class="col-lg-8 col-md-8 col-sm-12 main-content">                    
                    <h2 class="text-center">𝑩𝒓𝒊𝒈𝒉𝒕𝒐𝒏 𝑺𝒄𝒉𝒐𝒐𝒍</h2>
                    <h3 class="text-center mb-3">{{ class_instance.result_class_name }}</h3>
                    <div id="notification" class="alert alert-success" role="alert" style="display: none;">
                        Saved successfully!
                    </div>
                    <table class="table table-bordered rounded box_clr mt-5">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Math</th>
                                <th>Science</th>
                                <th>English</th>
                                <th>Hindi</th>
                                <th>Total_marks</th>
                                <th>Percentage</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results %}
                            <tr id="student-{{ student.id }}">
                                <td>{{result.st_name}}</td>
                                <td>{{result.Math}}</td>
                                <td>{{result.Science}}</td>
                                <td>{{result.English}}</td>
                                <td>{{result.Hindi}}</td>
                                <td>{{result.Total_marks}}</td>
                                <td>{{result.Percentage}}</td>
                                <td>
                                    <button type="button" class="btn btn-primary result-edit-btn" data-id="{{ result.id }}">Edit</button>
                                    <button type="button" class="btn btn-danger result-delete-btn" data-id="{{ result.id }}">Delete</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" class="btn btn-success">Submit</button>   
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        document.querySelectorAll('.result-edit-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const studentId = this.getAttribute('data-id');
                                fetch(`/get_result/${studentId}/`)
                                    .then(response => response.json())
                                    .then(data => {
                                        document.getElementById('student_id').value = data.id;
                                        document.getElementById('id_st_name').value = data.st_name;
                                        document.getElementById('id_math').value = data.Math;
                                        document.getElementById('id_science').value = data.Science;
                                        document.getElementById('id_english').value = data.English;
                                        document.getElementById('id_hindi').value = data.Hindi;
                                        document.getElementById('id_total_marks').value = data.Total_marks;
                                        document.getElementById('id_percentage').value = data.Percentage;
                                    })
                                    .catch(error => console.error("Error fetching data:", error));
                            });
                        });
                    
                        document.querySelectorAll('.result-delete-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const studentId = this.getAttribute('data-id');
                                fetch(`/delete_result/${studentId}/`, {
                                    method: 'POST',
                                    headers: {
                                        'X-CSRFToken': '{{ csrf_token }}'
                                    }
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.status === 'success') {
                                        const row = document.getElementById(`student-${studentId}`);
                                        row.parentNode.removeChild(row);
                                    }
                                });
                            });
                        });
                
                        const params = new URLSearchParams(window.location.search);
                        if (params.get('saved') === 'true') {
                            const notification = document.getElementById('notification');
                            notification.style.display = 'block';
                            setTimeout(() => {
                                notification.style.display = 'none';
                            }, 7000);
                        }
                    });
                    
                </script>
{% endblock content %}    


